<!DOCTYPE html>
<html>

<head>
  <title>TP Integrador - Control Tareas</title>
  <script src="https://kit.fontawesome.com/57cf2b3238.js" crossorigin="anonymous"></script>
  <style>
    .card {
      border-color: rgb(232 229 229);
      border-width: 0.1rem;
      border-style: solid;
      max-height: 12vh;
      padding: 0.5rem;
      width: -webkit-fill-available;
    }

    div.container {
      padding: 0.5rem;
      display: inline-flex;
    }

    #tarjetas-container {
      display: inline-flex;
    }

    div.container.section {
      width: 31vw;
      height: 75vh;
      border-style: dotted;
      border-color: rgb(199, 199, 199);
      margin: 0.1rem;
      display: flex;
      flex-direction: column;
    }

    #bSubmit {
      width: 10vw;
      height: 5vh;
      min-height: 35px;
      margin-right: 1vh;
      background-color: rgb(5, 210, 5);
      font-weight: bold;
      color: white;
      border-width: 0;
      border-radius: 0.5vw;
    }

    button:hover {
      cursor: pointer;
      background-color: rgb(1, 108, 1);
    }

    input {
      width: 87vw;
      border-radius: 0.5vw;
      border-color: rgb(199, 199, 199);
      border-style: solid;
    }

    input.title-readonly {
      border: none;
      width: 100%;
    }
  </style>
</head>

<body>
  <div style="margin: auto;">
    <div class="container">
      <input type="button" value="Agregar" id="bSubmit">
      <input type="text" name="titulo" id="titulo">
    </div>
    <div id="tarjetas-container">
      <div class="container section" id="tareas-por-hacer">
        <!-- Tareas por hacer -->
      </div>
      <div class="container section" id="tareas-en-curso">
        <!-- Tareas en curso -->
      </div>
      <div class="container section" id="tareas-finalizadas">
        <!-- Tareas finalizadas -->
      </div>
    </div>
  </div>

</body>
<script>

  const bSubmit = document.querySelector('#bSubmit');


  loadTarjetas();

  bSubmit.addEventListener('click', () => {
    //validar campos
    const titulo = document.querySelector('#titulo').value;
    if (titulo.trim() === '') return false;

    //mandar solicitud POST a /new
    fetch('/new', {
      method: 'POST',
      headers: { 'Content-type': 'application/json' },
      body: JSON.stringify({ titulo: titulo })
    })
      .then(res => res.text())
      .then(data => {
        // mostrar mensaje de error/Ã©xito
        alert(data);

        //actualizar lista de peliculas
        loadTarjetas();
      });




  });

  function loadTarjetas() {
    fetch('/get-tarjetas', { method: 'GET' })
      .then(res => res.json())
      .then(data => {
        const tarjetas = document.querySelector('#tareas-por-hacer');
        var newCard = document.createElement("div");
        newCard.className = "card";
        let html = '';
        data.tarjetas.forEach(tarjeta => {
          html += `        
          <span class="card">
          <div style="display: inline-flex;width: 100%;">
            <i class="fa-solid fa-pen" onclick="Editar(this)"></i>
            <i class="fa-solid fa-floppy-disk" onclick="Guardar(this)" style="display: none;"></i>
            <i class="fa-solid fa-xmark" onclick="Eliminar(this)"></i>
          </div>
          <input class="title-readonly" type="text" readonly value="${tarjeta.titulo}">
          <div style="display: inline-flex;">
            <i class="fa-solid fa-circle-chevron-left" onclick="MoverIzquierda(this)"></i>
            <i class="fa-solid fa-circle-chevron-right" onclick="MoverDerecha(this)"></i>
          </div>
        </span>`
        });
        document.getElementById("tareas-por-hacer").appendChild(newCard);
        document.getElementById("titulo").value = "";
        tarjetas.innerHTML = html;
      });
  }

  function Editar(icon) {
    var card = icon.closest(".card");
    card.querySelector(".title-readonly").readOnly = false;
    card.querySelector(".title-readonly").focus();
    icon.style.display = "none";
    card.querySelector(".fa-floppy-disk").style.display = "inline-block";
  }

  function Guardar(icon) {
    var card = icon.closest(".card");
    card.querySelector(".title-readonly").readOnly = true;
    icon.style.display = "none";
    card.querySelector(".fa-pen").style.display = "inline-block";
  }

  function Eliminar(icon) {
    var card = icon.closest(".card");
    card.remove();
  }

  function MoverIzquierda(icon) {
    var card = icon.closest(".card");
    var currentSection = card.closest(".section");
    var previousSection = currentSection.previousElementSibling;

    if (previousSection) {
      previousSection.appendChild(card);
    }
  }

  function MoverDerecha(icon) {
    var card = icon.closest(".card");
    var currentSection = card.closest(".section");
    var nextSection = currentSection.nextElementSibling;

    if (nextSection) {
      nextSection.appendChild(card);
    }
  }

</script>

</html>